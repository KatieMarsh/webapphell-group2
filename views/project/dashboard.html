<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/public/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/project/dashboard.css">
    <script src="/public/js/bootstrap.bundle.min.js"></script>
    <!-- Custom styles for this template-->
    <link href="/public/css/project/sb-admin-2.min.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand navbar-dark bg-danger ">
        <div class="container-fluid">
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto"> <!-- Added ms-auto class here -->
                    <li class="nav-item"><a class="nav-link active" href="#">Dashboard</a>
                    </li>
                    <li class="nav-item"><a class="nav-link active" href="#">My Booking</a>
                    </li>
                    <img class="avatar rounded-circle" src="/public/images/user_64px.png" height="40px">
                    <li class="nav-item"><a class="nav-link active" href="#">| John Doe
                        </a>
                    </li>
                </ul>

            </div>
        </div>
    </nav>
    <div class="mx-5">
        <h1 class="text-black">Dashboard</h1>
        <table class="table table-striped">
            <thead>
                <tr><th>Time slot</th> <th>Available</th> <th>Reserved</th> <th>Disabled</th></tr>
            </thead>
            <tbody id="table_dashboard">
            </tbody>
        </table

        <!-- History -->
        <h1 class="text-black">History</h1>
        <hr class="border border-dark border-2 opacity-50">
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Room</th>
                        <th>Meeting Agenda</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Who Book</th>
                        <th>Who Approved</th>
                    </tr>
                </thead>
                <tbody class="table-light" id="table_history">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Select tables
        const table_dashboard = document.querySelector('#table_dashboard');
        const table_history = document.querySelector('#table_history');

        // mock-up data
        const json_data = '[{"time":"08:00-10:00","available":"10","reserved":"10","disabled":"2"},{"time":"10:00-12:00","available":"20","reserved":"0","disabled":"2"},{"time":"13:00-15:00","available":"8","reserved":"12","disabled":"2"},{"time":"15:00-17:00","available":"5","reserved":"15","disabled":"2"}]';
        const json_history = '[{"room":"Study room 1","agenda":"Group study","date":"24/11/2023","time_slot_1":"0","time_slot_2":"0","time_slot_3":"0","time_slot_4":"1","whoBook":"John Doe","whoApprove":"Arjarn Surapong"},{"room":"Study room 1","agenda":"Group study","date":"24/11/2023","time_slot_1":"1","time_slot_2":"0","time_slot_3":"0","time_slot_4":"0","whoBook":"John Doe","whoApprove":"Arjarn Surapong"},{"room":"Study room 1","agenda":"Group study","date":"24/11/2023","time_slot_1":"0","time_slot_2":"1","time_slot_3":"0","time_slot_4":"0","whoBook":"John Doe","whoApprove":"Arjarn Surapong"}]';
        
        // Parse JSON to JS objects
        const data = JSON.parse(json_data);
        const history = JSON.parse(json_history);

        // Dashboard
        let rows = '';
        data.forEach(function(d){
            rows += `<tr>`;
            rows += `<td>${d.time}</td>`;
            rows += `<td>${d.available}</td>`;
            rows += `<td>${d.reserved}</td>`;
            rows += `<td>${d.disabled}</td>`;
            rows += `</tr>`;
        });
        table_dashboard.innerHTML = rows;

        // History
        let rows_history = '';
        history.forEach(function(h){
            rows_history += '<tr>';
            rows_history += `<td>${h.room}</td>`;
            rows_history += `<td>${h.agenda}</td>`;
            rows_history += `<td>${h.date}</td>`;
            if(h.time_slot_1 == "1"){
                rows_history += `<td>08:00 - 10:00</td>`;
            }
            else if (h.time_slot_2 == "1")
            {
                rows_history += `<td>10:00 - 12:00</td>`;
            }
            else if (h.time_slot_3 == "1")
            {
                rows_history += `<td>13:00 - 15:00</td>`;
            }
            else if (h.time_slot_4 == "1")
            {
                rows_history += `<td>15:00 - 17:00</td>`;
            }
            else{
                rows_history += `<td>Error</td>`;
            }
            rows_history += `<td>${h.whoBook}</td>`;
            rows_history += `<td>${h.whoApprove}</td>`;
            rows_history += '</tr>';
        });
        table_history.innerHTML = rows_history;

        // console.log(rows);
        

        // GET dashboard
        // async function getDashboard(){
        //     try {
        //         const response = await fetch('/getdashboard');
        //         if (response.ok) {
        //             const data = await response.json();
        //             let rows = '';
        //             data.forEach(function (room){

        //             });
        //         }
        //         else if (response.status == 500){
        //             const data = response.text();
        //             throw Error(data);
        //         }
        //     } catch (err) {
        //         console.error(err.message);
        //         Notifix.Report.failure('Error',err.message,'Close');
        //     }
        // }
    </script>

</body>

</html>